#! stdtmpl | standard
#proc genHtml(state: TState): string =
#  result = ""
<!doctype html>
<html lang="en">
<head>
  <title>Nimbuild</title>
</head>
<body>
  #if state.platforms.len() > 0:
    <p>Platforms: ${state.platforms.len}</p>
    <p>Status: ${state.platforms[0].status.status}</p>
    <p>${state.platforms[0].status.desc}</p>
    #if state.platforms[0].status.status >= sBuildSuccess:
    #var filePath = makeCommitPath(state.platforms[0].platform,
    #                               state.platforms[0].status.hash)
    #var zipFile  = addFileExt(filePath, "zip")
    #var bz2File  = addFileExt(filePath, "tar.bz2")
    <p>
      <a href="http://dom96.co.cc/nimbuild/downloads/${zipFile}">
        Download zip
      </a>
    </p>
    <p>
      <a href="http://dom96.co.cc/nimbuild/downloads/${bz2File}">
        Download tarball
      </a>
    </p>
    #end if
  #else:
    <p>Status: Idle</p>
  #end if
  
  <!-- Output information from database -->
  #var platforms: seq[string] = @[]
  #var commits = getCommits(state.database, platforms)
  #if platforms.len() > 0:
    <table>
      <tr>
        <th>Commit</th>
        #for p in items(platforms):
          <th>${p}</th>
        #end for
      </tr>
      #for i in items(commits):
        <tr>
        #for p in items(platforms):
          <td>${i[p].hash}</td>
          <td>${genPlatformResult(i[p])}</td> <!-- TODO: Get the desc in here -->
        #end for
        </tr>
      #end for
    </table>
  #else: 
    <p>No commits found</p>
  #end if
  
</body>
</html>
