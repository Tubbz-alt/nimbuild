#! stdtmpl | standard
#proc genCommitUrl(hash: string): string =
#  return joinUrl("https://github.com/Araq/Nimrod/commit/", hash)
#end proc
#proc genUserUrl(user: string): string = 
#  return joinUrl("https://github.com/", user)
#end proc
#proc genHtml(state: TState): string =
#  result = ""
<!doctype html>
<html lang="en">
<head>
  <title>NimBuild</title>
	<link rel="stylesheet" href="${genCssPath(state)}static/css/boilerplate.css">
	<link rel="stylesheet" href="${genCssPath(state)}static/css/style.css">
</head>
<body>
  <div id="header">NimBuild - Nimrod's build farm.</div>
  <div id="content">
  <!-- Output information from database -->
  #var platforms: seq[string] = @[]
  #var commits = getCommits(state.database, platforms) 
  ${genDownloadButtons(commits, platforms)}
  #if platforms.len() > 0:
    <table>
      <tr>
        <th>commit</th>
        #for p in items(platforms):
          <th>${p}</th>
        #end for
        <th>author</td>
        <th>date</th>
        <th>message</th>
      </tr>
      #for i in items(commits):
        <tr>
        #for p in items(platforms):
          <td><a href="${genCommitUrl(i[p].hash)}">${i[p].hash[0..11]}</a></td>
          <td>${genPlatformResult(i[p], state.platforms, genCssPath(state))}</td> <!-- TODO: Get the desc in here -->
          <td><a href="${genUserUrl(i[p].username)}">${i[p].username}</td>
          <td>${i[p].date}</td>
          <td>${i[p].commitMsg[0..60]}</td>
        #end for
        </tr>
      #end for
    </table>
  #else: 
    <p>No commits found</p>
  #end if
  
  #if state.platforms.len() > 0:
    <p>Platforms: ${state.platforms.len}</p>
    <p>Status: ${state.platforms[0].status.status}</p>
    <p>${state.platforms[0].status.desc}</p>
    
  #else:
    <p>Status: Idle</p>
  #end if
  
  </div>
</body>
</html>
